{% extends 'base.html' %}
{% block content %}
<!-- Page Header -->
<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h2 class="mb-2">
          <i class="bi bi-lightbulb me-2"></i>Career Advisor
        </h2>
        <p class="text-muted mb-0">Get personalized career guidance powered by AI</p>
      </div>
      <div class="mt-3 mt-md-0">
        <a href="{{ url_for('dashboard.home') if current_user.is_authenticated else url_for('home') }}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-2"></i>Back
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Quick Access for Logged-in Users with Resumes -->
{% if current_user.is_authenticated and has_resumes %}
<div class="row justify-content-center mb-4">
  <div class="col-lg-8">
    <div class="alert alert-info border-0 shadow-sm">
      <div class="d-flex align-items-start">
        <i class="bi bi-info-circle me-3 mt-1" style="font-size: 1.5rem;"></i>
        <div class="flex-grow-1">
          <h6 class="mb-2"><i class="bi bi-star-fill text-warning me-1"></i>Use Your Uploaded Resume</h6>
          <p class="mb-2 small">Click on any of your uploaded resumes to automatically fill the form below:</p>
          <div class="d-flex gap-2 flex-wrap">
            {% for resume in user_resumes %}
            <a href="{{ url_for('career_advice') }}?resume_id={{ resume.id }}" 
               class="btn btn-sm {% if selected_resume and selected_resume.id == resume.id %}btn-primary{% else %}btn-outline-primary{% endif %}">
              <i class="bi bi-file-earmark-text me-1"></i>{{ resume.filename[:30] }}{% if resume.filename|length > 30 %}...{% endif %}
            </a>
            {% endfor %}
          </div>
          {% if selected_resume %}
          <div class="mt-2">
            <small class="text-success">
              <i class="bi bi-check-circle-fill me-1"></i>
              Using resume: <strong>{{ selected_resume.filename }}</strong>
            </small>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Career Advice Form -->
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        {% if not current_user.is_authenticated %}
        <div class="alert alert-warning border-0 mb-4">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Tip:</strong> <a href="{{ url_for('auth.login') }}" class="alert-link">Login</a> or 
          <a href="{{ url_for('auth.signup') }}" class="alert-link">Sign up</a> to use your uploaded resumes for more accurate advice!
        </div>
        {% endif %}
        
        <form method="POST" action="/career_advice">
          <!-- Resume Text Input -->
          <div class="mb-4">
            <label for="resume_text" class="form-label">
              <i class="bi bi-file-text me-2"></i>Resume Text or Key Skills
            </label>
            <textarea 
              class="form-control" 
              id="resume_text" 
              name="resume_text" 
              rows="8" 
              required
              placeholder="Paste your resume text, key skills, or work experience here...">{{ resume_text|default('') }}</textarea>
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Include your skills, experience, education, and any relevant information
            </small>
          </div>

          <!-- Career Interests Input -->
          <div class="mb-4">
            <label for="interests" class="form-label">
              <i class="bi bi-heart me-2"></i>Career Interests (Optional)
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="interests" 
              name="interests" 
              value="{{ interests|default('') }}" 
              placeholder="e.g., Data Science, Marketing, Software Development" />
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Help us tailor advice to your interests
            </small>
          </div>

          <!-- Additional Instructions (Optional) -->
          {% if selected_resume %}
          <div class="mb-4">
            <label for="additional_info" class="form-label">
              <i class="bi bi-plus-circle me-2"></i>Additional Information (Optional)
            </label>
            <textarea 
              class="form-control" 
              id="additional_info" 
              name="additional_info" 
              rows="3" 
              placeholder="Add any additional context, goals, or specific questions..."></textarea>
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Your resume text is already loaded. Add extra details if needed.
            </small>
          </div>
          {% endif %}
          
          <!-- Submit Button -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-success btn-lg">
              <i class="bi bi-magic me-2"></i>Generate Career Advice
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Career Advice Results -->
{% if advice %}
<div class="row justify-content-center mt-4">
  <div class="col-lg-10">
    <div class="card border-0 shadow">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="card-title mb-0">
            <i class="bi bi-chat-left-quote text-primary me-2"></i>Your Personalized Career Advice
          </h4>
          {% if current_user.is_authenticated %}
          <span class="badge bg-success">
            <i class="bi bi-check-circle me-1"></i>AI Generated
          </span>
          {% endif %}
        </div>
        
        <div class="bg-light p-4 rounded-3 mb-4" style="line-height: 1.8;">
          <div style="white-space: pre-wrap;">{{ advice }}</div>
        </div>
        
        <!-- Action Buttons -->
        <div class="d-flex flex-wrap gap-2">
          <button onclick="window.print()" class="btn btn-outline-primary">
            <i class="bi bi-printer me-2"></i>Print Advice
          </button>
          <button onclick="copyToClipboard()" class="btn btn-outline-secondary">
            <i class="bi bi-clipboard me-2"></i>Copy to Clipboard
          </button>
          <a href="{{ url_for('career_advice') }}" class="btn btn-outline-success">
            <i class="bi bi-arrow-clockwise me-2"></i>Get New Advice
          </a>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('dashboard.home') }}" class="btn btn-outline-info">
            <i class="bi bi-speedometer2 me-2"></i>Go to Dashboard
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard() {
  const adviceText = `{{ advice | replace('\n', '\\n') | replace('"', '\\"') }}`;
  navigator.clipboard.writeText(adviceText).then(() => {
    alert('Career advice copied to clipboard!');
  }).catch(err => {
    console.error('Failed to copy:', err);
  });
}
</script>
{% endif %}

<!-- Info Cards -->
{% if not advice %}
<div class="row mt-5">
  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body text-center">
        <i class="bi bi-robot text-primary" style="font-size: 3rem;"></i>
        <h5 class="mt-3">AI-Powered Analysis</h5>
        <p class="text-muted mb-0">Advanced algorithms analyze your profile to provide tailored career guidance</p>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body text-center">
        <i class="bi bi-graph-up-arrow text-success" style="font-size: 3rem;"></i>
        <h5 class="mt-3">Growth Opportunities</h5>
        <p class="text-muted mb-0">Discover new career paths and opportunities aligned with your skills</p>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body text-center">
        <i class="bi bi-award text-warning" style="font-size: 3rem;"></i>
        <h5 class="mt-3">Expert Insights</h5>
        <p class="text-muted mb-0">Get professional recommendations based on industry trends and best practices</p>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
